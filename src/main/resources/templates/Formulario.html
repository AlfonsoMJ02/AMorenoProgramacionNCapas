<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>Formulario para agregear un nuevo usuario</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    </head>
    <body>
        <div class="container">
            <br>
            <h1 class="fw-bold text-center text-primary">Formulario para agregar un nuevo usuario</h1>
            <br>
            <form method="post" th:object="${usuario}" th:action="@{/Usuario/Form}">

                <div class="card mb-4 shadow-sm">
                    <div class="card-body">
                        <h5 class="mb-3"><i class="bi bi-person-vcard"></i> Datos personales</h5>

                        <div class="row g-4 align-items-start">

                            <div class="col-md-4 text-center">
                                <p class="fw-semibold mb-2">Foto de usuario</p>
                                <img src="";
                                     class="img-fluid rounded"
                                     style="width:200px; height:200px; object-fit:cover;"
                                     alt="Foto de usuario">
                            </div>

                            <div class="col-md-8">
                                <div class="row g-3">

                                    <div class="col-md-4">
                                        <label for="nombre" class="form-label">Nombre:</label>
                                        <input id="nombre" onpaste="return false;" type="text" class="form-control" placeholder="Nombre" th:field="*{Nombre}">
                                        <span class="text-danger" th:if="${#fields.hasErrors('Nombre')}" th:errors="*{Nombre}"></span>
                                    </div>

                                    <div class="col-md-4">
                                        <label for="apellidoPaterno" class="form-label">Apellido Paterno:</label>
                                        <!-- comment <input type="text" class="form-control" id="apellidoPaterno" name="apellido_paterno" onkeypress="SoloLetras(this, event)" onblur="SoloLetrasBlur(this)">-->
                                        <input id="nombre" type="text" class="form-control" placeholder="ApellidoPaterno" th:field="*{ApellidoPaterno}">
                                        <span class="text-danger" th:if="${#fields.hasErrors('ApellidoPaterno')}" th:errors="*{ApellidoPaterno}"></span>
                                        <!-- comment <span id="errorapellidoPaterno" style="red"></span>-->
                                    </div>

                                    <div class="col-md-4">
                                        <label for="apellidoMaterno" class="form-label">Apellido Materno:</label>
                                        <!-- comment <input type="text" class="form-control" id="apellidoMaterno" name="apellido_materno" onkeypress="SoloLetras(this, event)" onblur="SoloLetrasBlur(this)">-->
                                        <input id="nombre" type="text" class="form-control" placeholder="ApellidoMaterno" th:field="*{ApellidoMaterno}">
                                        <span class="text-danger" th:if="${#fields.hasErrors('ApellidoMaterno')}" th:errors="*{ApellidoMaterno}"></span>
                                        <!-- comment <span id="errorapellidoMaterno" style="red"></span>-->
                                    </div>
                                    
                                    <div class="col-md-4">
                                    <label>Sexo:</label>
                                    <div class="form-check">
                                        <input class="form-check-input" 
                                               type="radio" 
                                               th:field="*{sexo}" 
                                               value="Hombre" 
                                               id="radioDefault1">
                                        <label class="form-check-label" for="radioDefault1">
                                            Hombre
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" 
                                               type="radio" 
                                               th:field="*{sexo}" 
                                               value="Mujer" 
                                               id="radioDefault2">
                                        <label class="form-check-label" for="radioDefault2">
                                            Mujer
                                        </label>
                                    </div>
                                    <span class="text-danger"
                                          th:if="${#fields.hasErrors('sexo')}"
                                          th:errors="*{sexo}">
                                    </span>
                                </div>

                                    
                                    <div class="col-md-4">
                                        <label for="curp" class="form-label">CURP:</label>
                                        <input type="text" class="form-control" id="curp" name="curp" maxlength="18" onkeypress="CURP(this, event)">
                                        <!-- comment <span id="errorcurp"></span>-->
                                    </div>

                                    <div class="col-md-4">
                                        <label for="fechaNacimiento" class="form-label">Fecha de nacimiento:</label>
                                        <input type="date" class="form-control" id="fechaNacimiento" name="fecha_nacimiento">
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <div class="card mb-4 shadow-sm">
                    <div class="card-body">
                        <h5 class="mb-3"><i class="bi bi-shield-lock-fill"> Acceso y contacto</i></h5>

                        <div class="row g-4 align-items-start">

                            <div class="col-md-12">
                                <div class="row g-3">

                                    <div class="col-md-4">
                                        <label for="email" class="form-label">Email:</label>
                                        <input type="email" class="form-control" id="email" name="email" placeholder="name@example.com">
                                    </div>

                                    <div class="col-md-4">
                                        <label for="usuario" class="form-label">Nombre de usuario:</label>
                                        <input type="text" class="form-control" id="usuario" name="usuario" th:field="*{UserName}" onkeypress="UserName(this, event)" onblur="UserNameBlur(this)">
                                        <span class="text-danger" th:if="${#fields.hasErrors('UserName')}" th:errors="*{UserName}"></span>
                                        <!-- comment <span id="errorusuario"></span>-->
                                    </div>

                                    <div class="col-md-4">
                                        <label for="password" class="form-label">Password:</label>
                                        <!-- comment <input type="password" class="form-control" id="password" name="password">-->
                                        <input type="password" class="form-control" th:field="*{Password}" id="password" name="password">
                                        <span class="text-danger" th:if="${#fields.hasErrors('Password')}" th:errors="*{Password}"></span>
                                        <div class="form-text">
                                            Debe tener entre 8-20 caracteres.
                                        </div>
                                    </div>

                                    <div class="col-md-4">
                                        <label for="telefono" class="form-label">Teléfono:</label>
                                        <input type="tel"
                                               class="form-control"
                                               id="telefono"
                                               name="telefono"
                                               th:fiel="*{Telefono}"
                                               onkeypress="TelefonoCelular(this, event)"
                                               onblur="TelefonoBlur(this)">
                                        <!-- comment <span id="errortelefono"></span>-->
                                        <span class="text-danger" th:if="${#fields.hasErrors('Telefono')}" th:errors="*{Telefono}"></span>
                                    </div>

                                    <div class="col-md-4">
                                        <label for="celular" class="form-label">Celular:</label>
                                        <input type="tel"
                                               class="form-control"
                                               id="celular"
                                               name="celular"
                                               th:fiel="*{Celular}"
                                               onkeypress="TelefonoCelular(this, event)"
                                               onblur="TelefonoBlur(this)">
                                        <span class="text-danger" th:if="${#fields.hasErrors('Celular')}" th:errors="*{Celular}"></span>
                                        <!-- comment <span id="errorcelular"></span>-->
                                    </div>

                                    <div class="col-md-4">
                                        <label for="rol" class="form-label">Rol:</label>
                                        <select class="form-select" th:field="*{rol.idRol}">
                                            <option value=0 >Selecciona...</option>
                                            <option th:each="rol : ${roles}"
                                                    th:value="${rol.idRol}"
                                                    th:text="${rol.nombre}">
                                            </option>
                                            <span class="text-danger" th:if="${#fields.hasErrors('Rol')}" th:errors="*{Rol}"></span>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mb-4 shadow-sm">
                    <div class="card-body">
                        <h5 class="mb-3"><i class="bi bi-house-add-fill"></i> Domicilio </i></h5>

                        <div class="row g-4 align-items-start">

                            <div class="col-md-12">
                                <div class="row g-3">

                                    <div class="col-md-4">
                                        <label for="email" class="form-label">Calle:</label>
                                        <input type="text" class="form-control" id="usuario" name="usuario">
                                    </div>

                                    <div class="col-md-4">
                                        <label for="usuario" class="form-label">Número interior:</label>
                                        <input type="text" class="form-control" id="usuario" name="usuario">
                                    </div>

                                    <div class="col-md-4">
                                        <label for="usuario" class="form-label">Número exterior:</label>
                                        <input type="text" class="form-control" id="usuario" name="usuario">
                                    </div>

                                    <div class="col-md-4">
                                        <label class="form-label">Colonia:</label>
                                        <select id="colonia" class="form-select" th:field="*{colonia.idColonia}">
                                            <option value=0>Selecciona...</option>
                                        </select>
                                    </div>

                                    <div class="col-md-4">
                                        <label for="celular" class="form-label">CP:</label>
                                        <input type="tel" class="form-control" id="celular" name="celular">
                                    </div>

                                    <div class="col-md-4">
                                        <label class="form-label">Municipio:</label>
                                        <select id="municipio" class="form-select" th:field="*{municipio.idMunicipio}">
                                            <option value=0>Selecciona...</option>
                                            </select>
                                    </div>

                                    <div class="col-md-4">
                                        <label class="form-label">Estado:</label>
                                        <select id="estado" class="form-select" th:field="*{estado.idEstado}">
                                            <option value=0>Selecciona...</option>         
                                        </select>
                                    </div>


                                    <div class="col-md-4">
                                        <label for="pais" class="form-label">País:</label>
                                        <select id="pais" class="form-select" th:field="*{pais.idPais}">
                                            <option value=0 >Selecciona...</option>
                                            <option th:each="pais : ${paises}"
                                                    th:value="${pais.idPais}"
                                                    th:text="${pais.nombre}">
                                            </option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="col-12 text-center mt-3">
                    <button type="submit" class="btn btn-success">Guardar</button>
                    <a class="btn btn-danger" th:href="@{/Usuario}">Cancelar</a>
                </div>
            </form>
        </div>
 
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script>
        <!<!-- comment 
        function SoloLetras(input, event) {

    var valorCompleto = $(input).val() + event.key;
    var regex = /^[a-zá-úÁ-ÚA-Z\s]+$/;

    if (regex.test(valorCompleto)) {

        $('#error' + input.id).text('');
        $(input).removeClass('border border-danger');

    } else {

        event.preventDefault();
        $(input).addClass('border border-danger');
        $('#error' + input.id).text('Solo se permite introducir letras').css('color', 'red');
    }
}

function SoloLetrasBlur(input){
    var regex = /^[a-zá-úÁ-ÚA-Z\s]+$/;
    if (regex.test($(input).val())) {
        $('#error'+ input.id + '').text('');
        $(input).removeClass('border border-danger');
        $(input).addClass('border border-success');
    }
}

function CURP(input, event) {

    var curp = $(input).val() + even.key;
    var regex = /^[A-Z0-9]{0,18}$/; 

    if (regex.test(curp)) {

        $('#error' + input.id).text('');
        $(input).removeClass('border border-danger');

    } else {

        event.preventDefault();
        $(input).addClass('border border-danger');

        $('#error' + input.id)
            .text('Solo se permiten letras mayúsculas y números')
            .css('color', 'red');
    }
}

function CURPBlur(input){
    var regex = /^[A-Z]{4}[0-9]{6}[A-Z]{6}[0-9]{2}$/;

    if( regex.test(curp) < 18){

        $('#error' + input.id +'').text('');
        $(input)
            .removeClass('border border-danger')
            .addClass('border border-success');

    } else {

        $('#error' + input.id +'')
            .text('CURP inválido (debe tener 18 caracteres)')
            .css('color','red');

        $(input)
            .removeClass('border border-success')
            .addClass('border border-danger');
    }
}

function TelefonoCelular(input, event){

    var numero = $(input).val() + event.key;
    var regex = /^[0-9]{0,10}$/;

    if(regex.test(numero)){
        $('#error' + input.id).text('');
        $(input).removeClass('border border-danger');
    } else {
        event.preventDefault();
        $(input).addClass('border border-danger');
        $('#error' + input.id).text('Solo puedes escribir números (máx 10)').css('color', 'red');
    }
}

function TelefonoBlur(input){

    var numero = input.value;

    if(numero.length === 10){
        $('#error' + input.id).text('');
        $(input).removeClass('border border-danger').addClass('border border-success');
    } else {
        $('#error' + input.id).text('Debe tener exactamente 10 dígitos').css('color','red');
        $(input).removeClass('border border-success').addClass('border border-danger');
    }
}

function UserName(input, event){
    var user = $(input).val() + event.key;
    var regex = /^[A-Za-z0-9]+$/;
    
    if (regex.test(user)) {
        $('#error'+input.id).text('');
        $(input).removeClass('border border-danger');
    }else{
        event.preventDefault();
        $(input).addClass('border border-danger');
        $('#error'+input.id).text('Solo puedes ingresar letras y numeros').css('color', 'red');
    }
}

function UserNameBlur(input){
    var regex = /^[A-Za-z0-9]+$/;
    
    if (regex.test($(input).val())) {
        $('#error'+ input.id + '').text('');
        $(input).removeClass('border border-danger');
        $(input).addClass('border border-success');
    }
}
function Password(input, event){
    var pass = $(input).val() + event.key;
    var regex = /^/
}
-->
$(document).ready(function () {
    
    $("#pais").change(function () {

        var idPais = $("#pais").val();

        if (idPais && idPais !== "0") {

            $("#estado").empty().append('<option value="">Selecciona...</option>');
            $("#municipio").empty().append('<option value="">Selecciona...</option>');
            $("#colonia").empty().append('<option value="">Selecciona...</option>');

            $.ajax({
                url: '/Usuario/estado/getByPais/' + idPais,
                type: 'GET',
                success: function (result) {

                    if (result.correct) {
                        $.each(result.objects, function (i, estado) {
                            $("#estado").append(
                                '<option value="' + estado.IdEstado + '">' 
                                + estado.Nombre + 
                                '</option>'
                            );
                        });
                    }
                },
                error: function () {
                    alert("Error al cargar los estados");
                }
            });

        } else {

            $("#estado").empty().append('<option value="0" selected>Selecciona...</option>');
            $("#municipio").empty().append('<option value="0" selected>Selecciona...</option>');
            $("#colonia").empty().append('<option value="0" selected>Selecciona...</option>');
        }
    });

    $("#estado").change(function () {

        var idEstado = $("#estado").val();

        if (idEstado && idEstado !== "0") {

            $("#municipio").empty().append('<option value="">Selecciona...</option>');
            $("#colonia").empty().append('<option value="">Selecciona...</option>');

            $.ajax({
                url: '/Usuario/municipio/getByEstado/' + idEstado,
                type: 'GET',
                success: function (result) {

                    if (result.correct) {
                        $.each(result.objects, function (i, municipio) {
                            $("#municipio").append(
                                '<option value="' + municipio.IdMunicipio + '">' 
                                + municipio.Nombre + 
                                '</option>'
                            );
                        });
                    }
                },
                error: function () {
                    alert("Error al cargar los municipios");
                }
            });
        } else {

            $("#municipio").empty().append('<option value="0" selected>Selecciona...</option>');
            $("#colonia").empty().append('<option value="0" selected>Selecciona...</option>');
        }
    });

    $("#municipio").change(function () {

        var idMunicipio = $("#municipio").val();

        if (idMunicipio && idMunicipio !== "0") {

            $("#colonia").empty().append('<option value="">Selecciona...</option>');

            $.ajax({
                url: '/Usuario/colonia/getByMunicipio/' + idMunicipio,
                type: 'GET',
                success: function (result) {

                    if (result.correct) {
                        $.each(result.objects, function (i, colonia) {
                            $("#colonia").append(
                                '<option value="' + colonia.IdColonia + '">' 
                                + colonia.Nombre + 
                                '</option>'
                            );
                        });
                    }
                },
                error: function () {
                    alert("Error al cargar las colonias");
                }
            });

        } else {

            $("#colonia").empty().append('<option value="0" selected>Selecciona...</option>');
        }
    });

});
</script>
</body>
</html>
